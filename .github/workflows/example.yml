name: Postman to k6 Load Testing Example

# -----------------------------------------------------------------------------
# Example workflow demonstrating Postman to k6 conversion with load profiles
# -----------------------------------------------------------------------------

on:
  workflow_dispatch:
    inputs:
      postman-collection:
        description: 'Path to Postman collection JSON file'
        required: true
        default: 'postman/collection.json'
      load-profile:
        description: 'Load profile to run'
        required: false
        default: 'smoke'
        type: choice
        options:
          - smoke
          - load
          - stress
          - spike

jobs:
  load-test:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run Postman to k6 Load Test
        id: run-test
        uses: ./
        with:
          postman-collection: ${{ github.event.inputs.postman-collection }}
          load-profile: ${{ github.event.inputs.load-profile }}
          profiles-config: 'profiles/load-profiles.yaml'

      - name: Display Test Summary
        if: always()
        run: |
          echo "## Load Test Summary: ${{ github.event.inputs.load-profile }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Profile:** ${{ github.event.inputs.load-profile }}" >> $GITHUB_STEP_SUMMARY
          echo "**Status:** ${{ steps.run-test.outputs.test-status }}" >> $GITHUB_STEP_SUMMARY
          echo "**Script Path:** ${{ steps.run-test.outputs.k6-script-path }}" >> $GITHUB_STEP_SUMMARY
          if [ -n "${{ steps.run-test.outputs.metrics-url }}" ]; then
            echo "**Metrics:** ${{ steps.run-test.outputs.metrics-url }}" >> $GITHUB_STEP_SUMMARY
          fi
        shell: bash

  # Example: Run multiple profiles in parallel
  load-test-matrix:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        profile: [smoke, load, stress, spike]
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run Postman to k6 Load Test
        id: run-test
        uses: ./
        with:
          postman-collection: 'postman/collection.json'
          load-profile: ${{ matrix.profile }}
          profiles-config: 'profiles/load-profiles.yaml'

      - name: Display Test Summary
        if: always()
        run: |
          echo "## Load Test Summary: ${{ matrix.profile }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Profile:** ${{ matrix.profile }}" >> $GITHUB_STEP_SUMMARY
          echo "**Status:** ${{ steps.run-test.outputs.test-status }}" >> $GITHUB_STEP_SUMMARY
        shell: bash

